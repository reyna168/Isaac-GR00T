## OpenAI å›ç­”

å¥½çš„ ğŸ‘ æˆ‘å¹«ä½ é€æ®µè§£é‡‹é€™å€‹ eval_gr00t_so100.py ç¨‹å¼çš„è¨­è¨ˆèˆ‡åŠŸèƒ½ã€‚å®ƒä¸»è¦æ˜¯ NVIDIA GR00T æ¡†æ¶ä¸­æ©Ÿæ¢°æ‰‹è‡‚ç­–ç•¥æ¨ç†çš„è©•ä¼°è…³æœ¬ï¼Œæ”¯æ´ so100ã€so101 æ©Ÿæ¢°æ‰‹è‡‚ï¼Œä¸¦é€éèªè¨€æŒ‡ä»¤ + æ„Ÿæ¸¬è³‡æ–™ï¼Œä¾†åŸ·è¡Œå‹•ä½œã€‚

ğŸ”‘ ç¨‹å¼æ ¸å¿ƒåŠŸèƒ½

è®€å–æ©Ÿæ¢°æ‰‹è‡‚ï¼ˆso100/so101ï¼‰çš„å³æ™‚æ„Ÿæ¸¬è³‡æ–™ï¼ˆç›¸æ©Ÿ + é—œç¯€ç‹€æ…‹ï¼‰

å°‡è§€æ¸¬è³‡æ–™èˆ‡èªè¨€ä»»å‹™æŒ‡ä»¤ä¸Ÿåˆ°ã€Œç­–ç•¥æ¨ç†æœå‹™ã€

æ¥æ”¶ç­–ç•¥æœå‹™çš„ã€Œå‹•ä½œåºåˆ— (action chunk)ã€

é€æ­¥å°‡å‹•ä½œé€åˆ°æ©Ÿæ¢°æ‰‹è‡‚ï¼Œå®Œæˆä»»å‹™

ğŸ“‚ ç¨‹å¼çµæ§‹è§£æ
1. å¼•å…¥æ¨¡çµ„
import draccus
import matplotlib.pyplot as plt
import numpy as np
from lerobot.robots import make_robot_from_config
from service import ExternalRobotInferenceClient


draccusï¼šå‘½ä»¤åˆ—åƒæ•¸ç®¡ç†ï¼ˆåƒ argparse å‡ç´šç‰ˆï¼‰ã€‚

matplotlibï¼šç”¨ä¾†é¡¯ç¤ºç›¸æ©Ÿç•«é¢ã€‚

lerobotï¼šNVIDIA æä¾›çš„æ©Ÿæ¢°äººæ§åˆ¶å¥—ä»¶ï¼Œæ”¯æ´ so100 / so101ã€‚

ExternalRobotInferenceClientï¼šèˆ‡å¤–éƒ¨ ç­–ç•¥æ¨ç†ä¼ºæœå™¨ï¼ˆGR00T Policy Serverï¼‰æºé€šã€‚

2. Gr00tRobotInferenceClient
class Gr00tRobotInferenceClient:
    def __init__(self, host="localhost", port=5555, camera_keys=[], robot_state_keys=[], show_images=False):
        self.policy = ExternalRobotInferenceClient(host=host, port=port)
        self.camera_keys = camera_keys
        self.robot_state_keys = robot_state_keys
        self.show_images = show_images
        self.modality_keys = ["single_arm", "gripper"]


åˆå§‹åŒ–ä¸€å€‹ç­–ç•¥å®¢æˆ¶ç«¯ï¼Œç”¨ä¾†æŠŠã€Œæ©Ÿå™¨äººè§€æ¸¬è³‡æ–™ã€å‚³çµ¦ä¼ºæœå™¨ï¼Œä¸¦æ‹¿å›ã€Œå‹•ä½œè¨ˆç•«ã€ã€‚

camera_keysï¼šç›¸æ©Ÿåç¨±ï¼ˆå¦‚ wristã€frontï¼‰ã€‚

robot_state_keysï¼šé—œç¯€ç‹€æ…‹åç¨±ï¼ˆ6 å€‹ motor stateï¼‰ã€‚

show_imagesï¼šæ˜¯å¦é¡¯ç¤ºå½±åƒã€‚

3. get_action()
def get_action(self, observation_dict, lang: str):
    obs_dict = {f"video.{key}": observation_dict[key] for key in self.camera_keys}
    state = np.array([observation_dict[k] for k in self.robot_state_keys])
    obs_dict["state.single_arm"] = state[:5].astype(np.float64)
    obs_dict["state.gripper"] = state[5:6].astype(np.float64)
    obs_dict["annotation.human.task_description"] = lang


é€™è£¡åšäº†å¹¾ä»¶äº‹ï¼š

æŠŠ ç›¸æ©Ÿç•«é¢åŠ åˆ°è¼¸å…¥ã€‚

æŠŠ é—œç¯€ç‹€æ…‹ï¼ˆ5 å€‹æ‰‹è‡‚è‡ªç”±åº¦ + 1 å€‹å¤¾çˆªï¼‰åŠ å…¥ã€‚

åŠ å…¥ èªè¨€æŒ‡ä»¤ï¼ˆä¾‹å¦‚ã€ŒGrab pens and place into pen holderã€ï¼‰ã€‚

å‚³çµ¦ self.policy.get_action()ï¼Œå–å¾—ä¸€çµ„ å‹•ä½œåºåˆ— (action chunk)ã€‚

å›å‚³çš„æ˜¯ ä¸€ç³»åˆ—å‹•ä½œå­—å…¸ï¼š

[
  {"shoulder_pan.pos": 0.1, "elbow_flex.pos": -0.2, "gripper.pos": 0.5, ...},
  {"shoulder_pan.pos": 0.15, "elbow_flex.pos": -0.25, "gripper.pos": 0.55, ...},
  ...
]

4. view_img()
def view_img(img, overlay_img=None):
    if isinstance(img, dict):
        img = np.concatenate([img[k] for k in img], axis=1)
    plt.imshow(img)
    plt.title("Camera View")
    plt.axis("off")
    plt.pause(0.001)
    plt.clf()


ç”¨ matplotlib å³æ™‚é¡¯ç¤ºç›¸æ©Ÿç•«é¢ï¼ˆæ¯” cv2.imshow ç©©å®šï¼‰ã€‚

5. EvalConfig
@dataclass
class EvalConfig:
    robot: RobotConfig
    policy_host: str = "localhost"
    policy_port: int = 5555
    action_horizon: int = 8
    lang_instruction: str = "Grab pens and place into pen holder."
    play_sounds: bool = False
    timeout: int = 60
    show_images: bool = False


é€™æ˜¯ä¸€å€‹ åƒæ•¸è¨­å®šé¡åˆ¥ï¼Œå¯å¾å‘½ä»¤åˆ—å‚³å…¥ï¼š

robotï¼šæ©Ÿå™¨äººå‹è™Ÿ & è¨­å®šï¼ˆso100/so101ï¼‰ã€‚

policy_host/portï¼šGR00T ç­–ç•¥ä¼ºæœå™¨ä½ç½®ã€‚

lang_instructionï¼šèªè¨€ä»»å‹™æŒ‡ä»¤ã€‚

action_horizonï¼šä¸€æ¬¡è¦åŸ·è¡Œå¹¾æ­¥å‹•ä½œã€‚

6. eval() ä¸»æµç¨‹
@draccus.wrap()
def eval(cfg: EvalConfig):
    robot = make_robot_from_config(cfg.robot)
    robot.connect()

    camera_keys = list(cfg.robot.cameras.keys())
    robot_state_keys = list(robot._motors_ft.keys())

    policy = Gr00tRobotInferenceClient(
        host=cfg.policy_host,
        port=cfg.policy_port,
        camera_keys=camera_keys,
        robot_state_keys=robot_state_keys,
    )


å»ºç«‹æ©Ÿå™¨äººå¯¦ä¾‹ â†’ é€£æ¥ç¡¬é«”ã€‚

å–å¾—ç›¸æ©Ÿ & é¦¬é” keysã€‚

å»ºç«‹ç­–ç•¥å®¢æˆ¶ç«¯ï¼ˆèˆ‡ä¼ºæœå™¨æºé€šï¼‰ã€‚

7. Eval Loop
while True:
    observation_dict = robot.get_observation()
    action_chunk = policy.get_action(observation_dict, language_instruction)

    for i in range(cfg.action_horizon):
        action_dict = action_chunk[i]
        robot.send_action(action_dict)
        time.sleep(0.02)


æŒçºŒè¿´åœˆï¼š

å–å¾—ç•¶å‰è§€æ¸¬ï¼ˆå½±åƒ + ç‹€æ…‹ï¼‰ã€‚

é€åˆ°ç­–ç•¥ä¼ºæœå™¨ â†’ æ‹¿åˆ°å‹•ä½œåºåˆ—ã€‚

ä¾åºå°‡å‹•ä½œé€åˆ°æ©Ÿå™¨äººåŸ·è¡Œã€‚

ğŸ“ ç¸½çµ

é€™å€‹ç¨‹å¼çš„æ ¸å¿ƒä½œç”¨æ˜¯ï¼š

æ©‹æ¥ æ©Ÿå™¨äººç¡¬é«” (so100/so101) â†” ç­–ç•¥æ¨ç†ä¼ºæœå™¨ (GR00T Policy Server)ã€‚

æ¥æ”¶ç›¸æ©Ÿ + ç‹€æ…‹è³‡æ–™ï¼Œé…åˆèªè¨€æŒ‡ä»¤ â†’ å¾—åˆ°å‹•ä½œè¨ˆç•« â†’ æ§åˆ¶æ©Ÿå™¨äººåŸ·è¡Œä»»å‹™ã€‚

é©åˆç”¨ä¾†åš èªè¨€é©…å‹•çš„æ©Ÿæ¢°æ‰‹è‡‚ä»»å‹™æ¸¬è©¦ï¼ˆä¾‹å¦‚ï¼šæ’¿èµ·ç­† â†’ æ”¾åˆ°ç­†ç­’ï¼‰ã€‚

